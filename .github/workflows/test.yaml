on:
  push

jobs:
  deploy_docker:
    name: Deploy Docker Image
    runs-on: ubuntu-latest
    steps:
      # Checkout the code
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          path: top

      # Checkout cryo-det
      - name: Checkout cryo-det
        uses: actions/checkout@v2
        with:
          repository: slaclab/cryo-det
          token: ${{ secrets.SLACLAB_TOKEN }}
          path: cryo-det

      # Setup docker build environment
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      # Login to Dockerhub
      - name: Login to Dockerhub
        uses: docker/login-action@v1
        with:
          username: tidair
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      # Validate definitions
      - name: Validate definitions
        id: build
        shell: bash
        env:
          REPO_SLUG: ${{ github.repository }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SLACLAB_TOKEN: ${{ secrets.SLACLAB_TOKEN }}
          DOCKERHUB_ORG_NAME: tidair
          DOCKERHUB_REPO: pysmurf-server
        run: |
          echo "Test:"
          echo "======="
          echo "GITHUB_WORKSPACE = $GITHUB_WORKSPACE"
          echo $(pwd)
          echo $(git ls-remote --refs --tag https://27e79a8d876796c6fae53a41540323835574bb78@'github.com/slaclab/pysmurf)
          echo "-------"
          echo $(git ls-remote --refs --tag https://27e79a8d876796c6fae53a41540323835574bb78@github.com/slaclab/cryo-det)
          echo "======="


